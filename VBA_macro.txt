'
' Sample VBA macro definitions to be used to integrate Excel spreadsheets.
'
' https://github.com/ynad/caldav-py-handler
' info@danielevercelli.it
'


' macro to add events of training/formation. Single or multi-day. Hours might be provided too
Sub calAdd_training()
    ' compose event name
    EventName = (ActiveSheet.Name + " " + Cells(5, ActiveCell.Column))

    ' determine if course is marked to be taken - performs sub-string search. Key word is "TO DO"
    i = InStr(ActiveCell.Value, "TO DO")
    ' if key work is found, grep preceding string(s) as event date(s)
    If i <> 0 Then
        EventDate = Mid(ActiveCell.Value, 1, i - 2)
    Else
        EventDate = ActiveCell.Value
    End If

    ' Format must be "dd/mm/YYYY" or "dd/mm/YYYY-dd/mm/YYYY", no spaces
    date_array = Split(EventDate, "-", 2)
    ' 2 dates, multi-day event
    If UBound(date_array) > 0 Then
        start_day = date_array(0)
        end_day = date_array(1)
    ' single date, single day event
    Else
        start_day = date_array(0)
        end_day = date_array(0)
    End If

    ' call external script passing parameters in proper syntax
    Call Shell("python ./caldav-py-handler/caldav-ics-client.py" & " --name " & """" & EventName & """" & " --start_day " & start_day & " --end_day " & end_day & " --cal " & """" & "training" & """")
End Sub


' macro to add events of maintenance routines
Sub calAdd_maintenance()
    ' compose event name
    EventName = (ActiveSheet.Name + " " + Cells(ActiveCell.Row, 1))
    ' start and end day coincide. Hours might be provided too
    start_day = ActiveCell.Value

    end_day = ActiveCell.Value
    ' call external script passing parameters in proper syntax
    Call Shell("python ./caldav-py-handler/caldav-ics-client.py" & " --name " & """" & EventName & """" & " --start_day " & start_day & " --end_day " & end_day & " --cal " & """" & "maintenance" & """")
End Sub


' macro to iterate over a predefined set of cells and copy/fill values on given conditions
Sub Deadline()
    For Each c In Worksheets("One").Range("B10:B12").Cells
        If c.Value > 0 Then Worksheets("SUMMARY").Range("D5").Value = c.Value
    Next
    For Each c In Worksheets("Two").Range("C10:C12").Cells
        If c.Value > 0 Then Worksheets("SUMMARY").Range("C5").Value = c.Value
    Next
    For Each c In Worksheets("Three").Range("D10:D12").Cells
        If c.Value > 0 Then Worksheets("SUMMARY").Range("B5").Value = c.Value
    Next
End Sub


'
Sub Range()
    Dim rng As Range: Set rng = Application.Range("Caldaia!B10:C12")
    Dim cel As Range
    For Each cel In rng.Cells
        With cel
            Debug.Print .Address & ":" & .Value
        End With
    Next cel
End Sub


' macro trigger with double click on any cell inside given range
Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    If Not Application.Intersect(Target, Range("A1:E21")) Is Nothing Then
        EventName = (ActiveSheet.Name + " " + Range("A10").Value)
        Call Shell("python ./caldav-py-handler/caldav-ics-client.py" & " --name " & EventName & " --start_day " & Target.Value & " --end_day " & Target.Value)
    End If
End Sub
